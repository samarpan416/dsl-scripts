<scraper name="shopifyGetSaleOrderDetailsScript" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.unicommerce.com/schema/scraper-1.0.xsd" cachehttpclient="false">
	<log level="debug" value="#{#TAG} SaleOrderDetailElement : #{#saleOrderDetailElement.toString()}" />

	<method name="prepareCustomFieldXML">
		<startTag name="CustomFields" />
			<var name="customFieldValuesItr" value="#{#customFieldValues.iterator()}" />
			<while condition="#{#customFieldValuesItr.hasNext()}">
				<var name="customField" value="#{#customFieldValuesItr.next()}" />
				<startTag name="CustomField">
					<attribute name="name" value="#{T(com.unifier.core.utils.JsonUtils).getAsString(#customField, 'name')}" />
					<attribute name="value" value="#{T(com.unifier.core.utils.JsonUtils).getAsString(#customField, 'value')}" />
				</startTag>
				<endTag name="CustomField" />
			</while>
		<endTag name="CustomFields" />
	</method>

	<method name="prepareAddressXML">
		<startTag name="Address">
			<attribute name="id" value="#{#address.get('id').getAsString()}" />
		</startTag>
		<valueTag name="Name" value="#{#address.get('name').getAsString()}" cdata="true" />
		<valueTag name="AddressLine1" value="#{#address.get('addressLine1').getAsString()}" cdata="true" />
		<valueTag name="AddressLine2" value="#{#address.get('addressLine2').getAsString()}" cdata="true" />
		<valueTag name="City" value="#{#address.get('city').getAsString()}" cdata="true" />
		<valueTag name="State" value="#{#address.get('state').getAsString()}" cdata="true" />
		<valueTag name="Pincode" value="#{#address.get('pincode').getAsString()}" cdata="true" />
		<valueTag name="Country" value="#{#address.get('country').getAsString()}" cdata="true" />
		<valueTag name="Phone" value="#{#address.get('phone').getAsString()}" cdata="true" />
		<endTag name="Address" />
	</method>

	<method name="prepareSaleOrderItemXML">
		<startTag name="SaleOrderItem" />
		<valueTag name="Code" value="#{#saleOrderItem.get('code').getAsString()}" />
		<valueTag name="ChannelSaleOrderItemCode" value="#{#saleOrderItem.get('channelSaleOrderItemCode').getAsString()}" />
		<valueTag name="ItemSKU" value="#{#saleOrderItem.get('itemSku').getAsString()}" cdata="true" />
		<valueTag name="ChannelProductId" value="#{#saleOrderItem.get('channelProductId').getAsString()}" cdata="true" />
		<valueTag name="ItemName" value="#{#saleOrderItem.get('itemName').getAsString()}" cdata="true" />
		<valueTag name="ShippingMethodCode" value="#{#saleOrderItem.get('shippingMethodCode').getAsString()}" />
		<valueTag name="GiftMessage" value="#{#saleOrderItem.get('giftMessage').getAsString()}" cdata="true" />
		<valueTag name="Discount" value="#{#saleOrderItem.get('discount').getAsBigDecimal()}" />
		<valueTag name="TotalPrice" value="#{#saleOrderItem.get('totalPrice').getAsBigDecimal()}" />
		<valueTag name="SellingPrice" value="#{#saleOrderItem.get('sellingPrice').getAsBigDecimal()}" />
		<valueTag name="VoucherCode" value="#{T(com.unifier.core.utils.JsonUtils).getAsString(#saleOrderItem, 'voucherCode')}" cdata="true" />
		<valueTag name="PacketNumber" value="#{#saleOrderItem.get('packetNumber').getAsInt()}" />
		<endTag name="SaleOrderItem" />
	</method>

	<method name="prepareCreateSaleOrderRequestXML">
		<startTag name="CreateSaleOrderRequest">
			<attribute name="xmlns" value="http://uniware.unicommerce.com/services/" />
		</startTag>
		<startTag name="SaleOrder" />
		<valueTag name="Code" value="#{#wsSaleOrder.get('code').getAsString()}" />
		<valueTag name="CashOnDelivery" value="#{#wsSaleOrder.get('cashOnDelivery').getAsBoolean()}" />
		<valueTag name="DisplayOrderCode" value="#{#wsSaleOrder.get('displayOrderCode').getAsString()}" />
		<valueTag name="AdditionalInfo" value="#{T(com.unifier.core.utils.JsonUtils).getAsString(#wsSaleOrder, 'additionalInfo')}" />
		<valueTag name="TransactionId" value="#{T(com.unifier.core.utils.JsonUtils).getAsString(#wsSaleOrder, 'transactionId')}" />
		<valueTag name="PaymentMode" value="#{#wsSaleOrder.get('paymentMode').getAsString()}" />
		<valueTag name="TransactionDate" value="#{#wsSaleOrder.get('transactionDate').getAsString()}" />
		<valueTag name="DisplayOrderDateTime" value="#{#wsSaleOrder.get('displayOrderDateTime').getAsString()}" cdata="true" />
		<valueTag name="NotificationMobile" value="#{#wsSaleOrder.get('notificationMobile').getAsString()}" />
		<valueTag name="NotificationEmail" value="#{#wsSaleOrder.get('notificationEmail').getAsString()}" cdata="true" />
		<valueTag name="CurrencyCode" value="#{#wsSaleOrder.get('currencyCode').getAsString()}" />
		<valueTag name="CustomerGSTIN" value="#{T(com.unifier.core.utils.JsonUtils).getAsString(#wsSaleOrder, 'customerGSTIN')}" />
		<valueTag name="TotalShippingCharges" value="#{#wsSaleOrder.get('totalShippingCharges').getAsBigDecimal()}" />
		<valueTag name="TotalCashOnDeliveryCharges" value="#{#wsSaleOrder.get('totalCashOnDeliveryCharges').getAsBigDecimal()}" />
		<valueTag name="TotalPrepaidAmount" value="#{#wsSaleOrder.get('totalPrepaidAmount').getAsBigDecimal()}" />

		<startTag name="Addresses" />
		<var name="addressesItr" value="#{#wsSaleOrder.get('addresses').getAsJsonArray().iterator()}" />
		<while condition="#{#addressesItr.hasNext()}">
			<var name="address" value="#{#addressesItr.next()}" />
			<invoke method="prepareAddressXML">
				<param name="address" value="#{#address}" />
			</invoke>
		</while>
		<endTag name="Addresses" />

		<startTag name="BillingAddress">
			<attribute name="ref" value="#{#wsSaleOrder.get('billingAddress').get('referenceId').getAsString()}" />
		</startTag>
		<endTag name="BillingAddress" />

		<startTag name="ShippingAddress">
			<attribute name="ref" value="#{#wsSaleOrder.get('shippingAddress').get('referenceId').getAsString()}" />
		</startTag>
		<endTag name="ShippingAddress" />

		<startTag name="SaleOrderItems" />

		<var name="saleOrderItemsItr" value="#{#wsSaleOrder.get('saleOrderItems').getAsJsonArray().iterator()}" />
		<while condition="#{#saleOrderItemsItr.hasNext()}">
			<var name="saleOrderItem" value="#{#saleOrderItemsItr.next()}" />
			<invoke method="prepareSaleOrderItemXML">
				<param name="saleOrderItem" value="#{#saleOrderItem}" />
			</invoke>
		</while>
		<endTag name="SaleOrderItems" />
		<if condition="#{#wsSaleOrder.get('totalDiscount') != null and !#wsSaleOrder.get('totalDiscount').isJsonNull()}">
			<valueTag name="TotalDiscount" value="#{#wsSaleOrder.get('totalDiscount').getAsBigDecimal()}" />
		</if>
		<invoke method="prepareCustomFieldXML">
			<param name="customFieldValues" value="#{#wsSaleOrder.get('customFieldValues').getAsJsonArray()}" />
		</invoke>

		<endTag name="SaleOrder" />
		<endTag name="CreateSaleOrderRequest" />
	</method>

	<invoke method="prepareCreateSaleOrderRequestXML">
		<param name="wsSaleOrder" value="#{T(com.unifier.core.utils.JsonUtils).stringToJson(#saleOrderDetailElement)}" />
	</invoke>
</scraper>